---
title: "cafe_sales_analysis"
author: "Victoria Stavish"
date: "2022-12-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# load libraries 

```{r}

library(tidyverse)
library(dplyr)
library(janitor)
library(readxl)
library(writexl)
library(ggplot2)

```

# load data 

```{r}

cafe_2020 <- read_excel("cafe_2020.xlsx")

cafe_2021 <- read_excel("cafe_2021.xlsx")

cafe_2022 <- read_excel("cafe_2022.xlsx")

```

# clean data and add cafe_totals column

```{r}

cafe_2020 <- cafe_2020 %>%
  clean_names() %>%
  rename(cafe = "calendar_year_2020") %>%
  mutate(cafe_total = rowSums(across(where(is.numeric)), 
        na.rm = TRUE)) %>%
  arrange(desc(cafe_total))

cafe_2021 <- cafe_2021 %>%
  clean_names() %>%
  rename(cafe = "calendar_year_2021") %>%
  mutate(cafe_total = rowSums(across(where(is.numeric)), 
        na.rm = TRUE)) %>%
  arrange(desc(cafe_total))

cafe_2022 <- cafe_2022 %>%
  clean_names() %>%
  rename(cafe = "calendar_year_2022") %>%
  mutate(cafe_total = rowSums(across(where(is.numeric)), 
        na.rm = TRUE)) %>%
  arrange(desc(cafe_total))

```

# which cafes closed in 2021? 2022?

# 9 cafes total have closed since 2020. 8 closed in 2021 and 1 closed in 2022.

```{r}

closed_cafes_2021 <- anti_join(cafe_2020, cafe_2021, by="cafe") %>%
  as.data.frame()

closed_cafes_2022 <- anti_join(cafe_2021, cafe_2022, by="cafe") %>%
  as.data.frame()

```

# 2020 revenue pivot_longer so it works for bar chart

```{r}

cafe_2020_bar <- cafe_2020 %>%
  pivot_longer(
    cols = ends_with("2020"),
    names_to = "month",
    values_to = "income"
  ) %>%
  drop_na() %>%
  arrange(desc(income))

```

# 2021 revenue pivot_longer so it works for bar chart

```{r}

cafe_2021_bar <- cafe_2021 %>%
  pivot_longer(
    cols = ends_with("2021"),
    names_to = "month",
    values_to = "income"
  ) %>%
  arrange(desc(income))

```

# 2022 revenue pivot_longer so it works for bar chart

```{r}

cafe_2022_bar <- cafe_2022 %>%
  pivot_longer(
    cols = ends_with("2022"),
    names_to = "month",
    values_to = "income"
  ) %>%
  arrange(desc(income))

```

# bind all pivoted dataframes to see ovrall income by year and by cafe

```{r}

options(scipen=999)

year_sum20 <- cafe_2020 %>%
  bind_rows(summarise(., across(where(is.numeric), sum),
                         across(where(is.character), ~'month_total')))

sum_20 <- data.frame (first_column  = c("811620.23")
                  ) %>%
  mutate(first_column = as.numeric(first_column))

year_sum21 <- cafe_2021 %>%
  bind_rows(summarise(., across(where(is.numeric), sum),
                         across(where(is.character), ~'month_total'))) 

sum_21 <- data.frame (first_column  = c("1630942.70")
                  ) %>%
  mutate(first_column = as.numeric(first_column))

year_sum22 <- cafe_2022 %>%
  bind_rows(summarise(., across(where(is.numeric), sum),
                         across(where(is.character), ~'month_total')))

sum_22 <- data.frame (first_column  = c("2656101.62")
                  ) %>%
  mutate(first_column = as.numeric(first_column))


yearly_sums <- cbind(sum_20, sum_21, sum_22) %>%
  rename("2020" = 1, "2021" = 2, "2022" = 3) %>%
  pivot_longer(
    cols = starts_with("20"),
    names_to = "year",
    values_to = "income"
  )

ggplot(yearly_sums) +
  geom_bar(aes(x = year, weight=income)) +
  ggtitle("total sales acrosss all cafes, by year")

```

# which months were the biggest/lowest earners each year?

```{r}

cafe_monthly_2020 <- cafe_monthly_2020 %>%
  clean_names() %>%
  arrange(desc(monthly_totals))

cafe_monthly_2021 <- cafe_monthly_2021 %>%
  clean_names() %>%
  arrange(desc(monthly_totals))

cafe_monthly_2022 <- cafe_monthly_2022 %>%
  clean_names() %>%
  arrange(desc(monthly_totals))


```

# which cafes were the biggest/lowest earners each year?

```{r}

cafe_2020_plot <- cafe_2020 %>%
  arrange(desc(cafe_total))

ggplot(cafe_2020_plot) +
  geom_bar(aes(x = reorder(cafe, cafe_total), weight=cafe_total)) +
  ggtitle("cafe revenues 2020")+
  coord_flip() 
  
cafe_2021_plot <- cafe_2021 %>%
  arrange(desc(cafe_total))

ggplot(cafe_2021_plot) +
  geom_bar(aes(x = reorder(cafe, cafe_total), weight=cafe_total)) +
  ggtitle("cafe revenues 2021")+
  coord_flip()
  
cafe_2022_plot <- cafe_2022 %>%
  arrange(desc(cafe_total))

ggplot(cafe_2022_plot) +
  geom_bar(aes(x = reorder(cafe, cafe_total), weight=cafe_total)) +
  ggtitle("cafe sales 2022")+
  coord_flip()

```






