---
title: "Legder Data -- Maryland Correctional Enterprises"
by: Shreya Vuttaluru
output: html_notebook
---

```{r}

options(scipen=999)

library(tidyverse)
#install.packages("dplyr")
library(janitor)
library(lubridate)
#install.packages("censusxy")
library(censusxy)
library(dplyr)
library(parallel)
library(tictoc)
library(furrr)
library(leaflet)
library(leaflet.extras)
library(sf)
#install.packages("sp")
library(sp)
#install.packages("readxl")
library(readxl)
library(data.table)
library(jsonlite)
library(geojsonsf)
library(geojsonio)
#install.packages(c("rgdal", "tidycensus"))
library(tidycensus)
#install.packages("fuzzyjoin")
library(fuzzyjoin)
#install.packages("stringdist")
library(stringdist)
#install.packages("rmapzen")
library(rmapzen)
#install.packages("writexl")
library(writexl)
library(rgdal)
#install.packages("spatialEco")
library(spatialEco)
#install.packages("raster")
library(raster)
library(dplyr)

```

Reading in data
```{r}

ledger_2017 <- read_excel("ledger_data/2017.xls") %>%
  clean_names() %>%
  mutate(
    year = as.numeric(format(po_date,'%Y'))
  ) #%>%
  #distinct(po_number, .keep_all=TRUE)

ledger_2018 <- read_excel("ledger_data/2018.xls") %>%
  clean_names() %>%
  mutate(
    year = as.numeric(format(po_date,'%Y'))
  ) #%>%
  #distinct(po_number, .keep_all=TRUE)

ledger_2019 <- read_excel("ledger_data/2019.xls") %>%
  clean_names() %>%
  mutate(
    year = as.numeric(format(po_date,'%Y'))
  ) #%>%
  #distinct(po_number, .keep_all=TRUE)

ledger_2020 <- read_excel("ledger_data/2020.xls") %>%
  clean_names() %>%
  mutate(
    year = as.numeric(format(po_date,'%Y'))
  ) #%>%
  #distinct(po_number, .keep_all=TRUE)

ledger_2021 <- read_excel("ledger_data/2021.xlsx") %>%
  clean_names() %>%
  mutate(
    po_date = pay_dt,
    grand_total_amt = amt_paid,
    year = as.numeric(format(po_date,'%Y'))
  ) 

ledger_2022 <- read_excel("ledger_data/2022.xlsx") %>%
  clean_names() %>%
  mutate(
    year = as.numeric(format(po_date,'%Y'))
  ) #%>%
  #distinct(po_number, .keep_all=TRUE)

```

Analysis!
```{r}

### Filtering for Maryland correctional enterprises in each year

years <- lst(2017, 2018, 2019, 2020, 2021, 2022)

all_years <- bind_rows(ledger_2017, ledger_2018, ledger_2019, ledger_2020, ledger_2021, ledger_2022)

for (year in years){
  
  spending <- all_years %>%
  filter(year == year) %>%
  filter(vendor_name == "MARYLAND CORRECTIONAL") %>%
  filter(!is.na(grand_total_amt)) %>%
  group_by(vendor_name, year) %>%
  summarize(
   total_spending = sum(grand_total_amt)
  )
  
  spending <- bind_rows(spending)
  
  print(spending)
}

plot <- ggplot(data=spending, aes(x=year, y=total_spending)) +
    geom_line()
  
plot
  

```

```

#finding most common depts 2021-2022

```{r}
depts_2021 <- correctional_spending_2021 %>%
  group_by(organization_name) %>%
  tally() %>%
  mutate(percent = (n / sum(n) * 100)) %>%
  arrange(desc(percent))

depts_2022 <- correctional_spending_2022 %>%
  group_by(organization_name) %>%
  tally() %>%
  mutate(percent = (n / sum(n) * 100)) %>%
  arrange(desc(percent))

# now looking at most common depts orders overall 2021

res_facilities2021 <- correctional_spending_2021 %>%
  filter(organization_name == "VPSA-Res Facilities-Admin Svcs")

vp_2021 <- correctional_spending_2021 %>%
  filter(organization_name == "SVPAAP-Sr VP Academic Affairs & Provost")

tech_2021 <- correctional_spending_2021 %>%
  filter(organization_name == "VPA-FM-P&C-Technical Support")

# most commons depts orders overall 2022

cmns_2022 <- correctional_spending_2022 %>%
  filter(organization_name == "CMNS-Chemistry & Biochemistry")

sphl_2022 <- correctional_spending_2022 %>%
  filter(organization_name == "SPHL-School of Public Health")

  
```
#Finding most common order titles

```{r}
items_2017 <- correctional_spending_2017 %>%
  group_by(item_ld) %>%
  tally() %>%
  mutate(percent = (n / sum(n) * 100)) %>%
  arrange(desc(percent))

items_2018 <- correctional_spending_2018 %>%
  group_by(item_ld) %>%
  tally() %>%
  mutate(percent = (n / sum(n) * 100)) %>%
  arrange(desc(percent))

items_2019 <- correctional_spending_2019 %>%
  group_by(item_ld) %>%
  tally() %>%
  mutate(percent = (n / sum(n) * 100)) %>%
  arrange(desc(percent))

items_2020 <- correctional_spending_2020 %>%
  group_by(item_ld) %>%
  tally() %>%
  mutate(percent = (n / sum(n) * 100)) %>%
  arrange(desc(percent))

items_2021 <- correctional_spending_2021 %>%
  group_by(itm_desc) %>%
  tally() %>%
  mutate(percent = (n / sum(n) * 100)) %>%
  arrange(desc(percent))

items_2022 <- correctional_spending_2022 %>%
  group_by(item_ld) %>%
  tally() %>%
  mutate(percent = (n / sum(n) * 100)) %>%
  arrange(desc(percent))
  
```


# recruiting money 2022
```{r}

# "football Recruiting" and "Charter bus services for football official visits June 2022" and "National HS, Offer Tracker, Transfer - BCS" and "Charter bus services for Football Official Visit weekend 6.24-6.2" and "Charter bus services for Football Official Visit weekends Jun" and "Whistle Recruiting - Recruiting Software" and "DMV Classified - DC, VA (NOVA/Tidewater), and MD (PG County) Premium Scouting Packages" and "Front Rush/Zcruit Recruiting Software" and "Pro Football Focus - Football Scouting Software FY23"
presica_football22 <- ledger_2022 %>%
  clean_names() %>%
  filter(grepl("PRES-ICA-Football", organization_name))

recruit_football22 <- presica_football22 %>%
  filter(item_ld %in% c("Football recruiting", "Football Recruiting", "Charter bus services for football official visits June 2022", "Recruiting subscription service; transfer portal for 2022 (Advanced Plus Package March 2022-February 2023)", "Charter bus services for Football Official Visit weekends June 2022 (6.3-6.23.22)", "National HS, Offer Tracker, Transfer - BCS", "Charter bus services for Football Official Visit weekend 6.24-6.26.22", "Whistle Recruiting - Recruiting Software", "DMV Classified - DC, VA (NOVA/Tidewater), and MD (PG County) Premium Scouting Packages", "Front Rush/Zcruit Recruiting Software", "Pro Football Focus - Football Scouting Software FY23", "National HS, Offer Tracker, Transfer - BCS", "The Underclassman Report - National Package with Portal and Archive 2022-23"))


# "Synergy Sports WBB Database 2022-2023" and "WBB recruiting service for the 2022-23 season" and "FastRecruit Plus & FastScout Plus 2022-2023 Subscription" and "On Location Events - RMA charter bus services for WBB offic"
presica_womens22 <- ledger_2022 %>%
  clean_names() %>%
  filter(grepl("PRES-ICA-Women's Sports", organization_name))

recruit_wbb22 <- presica_womens22 %>%
  filter(item_ld %in% c("Synergy Sports WBB Database 2022-2023", "WBB recruiting service for the 2022-23 season", "FastRecruit Plus & FastScout Plus 2022-2023 Subscription", "On Location Events - RMA charter bus services for WBB official visit event in DC 7.30.22" ))
  

# "Gold Level Membership to scouting service" and "Assistance with scouting reports during the 2021-22 season" and "FastRecruit Premier: Men's Basketball recruiting scheduling ser" and "National Recruiting Report - Recruiting service Men's Basket" and "Absolute Basketball - Men's Basketball recruiting service 20" and "On the Radar Hoops - Men's Basketball 2022-2023 Recruitin" and "
presica_basketball22 <- ledger_2022 %>%
  clean_names() %>%
  filter(grepl("PRES-ICA-Men's Basketball", organization_name))

recruit_bbal22 <- presica_basketball22 %>%
  filter(item_ld %in% c("Gold Level Membership to scouting service", "Assistance with scouting reports during the 2021-22 season", "FastRecruit Premier: Men's Basketball recruiting scheduling service", "National Recruiting Report - Recruiting service Men's Basketball 2022-23", "Absolute Basketball - Men's Basketball recruiting service 2022-2023", "On the Radar Hoops - Men's Basketball 2022-2023 Recruiting package", "FastScout Premier: Men's Basketball recruiting scheduling service", "7.26.22 Recruit Photo Shoot"))



# none
presica_postseason22 <- ledger_2022 %>%
  clean_names() %>%
  filter(grepl("PRES-ICA-Post Season", organization_name))

# none
presica_othermen22 <- ledger_2022 %>%
  clean_names() %>%
  filter(grepl("PRES-ICA-Other Men's Sports", organization_name))


# none
presica_external22 <- ledger_2022 %>%
  clean_names() %>%
  filter(grepl("PRES-ICA-External Relations", organization_name))

# none
presica_support22 <- ledger_2022 %>%
  clean_names() %>%
  filter(grepl("PRES-ICA-Support Services", organization_name))

# none
presica_operations22 <- ledger_2022 %>%
  clean_names() %>%
  filter(grepl("PRES-ICA-Operations", organization_name))
               
# list of all Pres-ica departments
# PRES-ICA-Football, PRES-ICA-Women's Sports | PRES-ICA-Men's Basketball | PRES-ICA-Post Season | PRES-ICA-Other Men's Sports | PRES-ICA-External Relations | PRES-ICA-Support Services | PRES-ICA-Operations 

#total list 

total22_vendors <- ledger_2022 %>%
  clean_names()%>%
   filter(item_ld %in% c("Football recruiting", "Football Recruiting", "Charter bus services for football official visits June 2022", "Recruiting subscription service; transfer portal for 2022 (Advanced Plus Package March 2022-February 2023)", "Charter bus services for Football Official Visit weekends June 2022 (6.3-6.23.22)", "National HS, Offer Tracker, Transfer - BCS", "Charter bus services for Football Official Visit weekend 6.24-6.26.22", "Whistle Recruiting - Recruiting Software", "DMV Classified - DC, VA (NOVA/Tidewater), and MD (PG County) Premium Scouting Packages", "Front Rush/Zcruit Recruiting Software", "Pro Football Focus - Football Scouting Software FY23", "National HS, Offer Tracker, Transfer - BCS", "The Underclassman Report - National Package with Portal and Archive 2022-23, Synergy Sports WBB Database 2022-2023", "WBB recruiting service for the 2022-23 season", "FastRecruit Plus & FastScout Plus 2022-2023 Subscription", "On Location Events - RMA charter bus services for WBB official visit event in DC 7.30.22, Gold Level Membership to scouting service", "Assistance with scouting reports during the 2021-22 season", "FastRecruit Premier: Men's Basketball recruiting scheduling service", "National Recruiting Report - Recruiting service Men's Basketball 2022-23", "Absolute Basketball - Men's Basketball recruiting service 2022-2023", "On the Radar Hoops - Men's Basketball 2022-2023 Recruiting package", "FastScout Premier: Men's Basketball recruiting scheduling service", "7.26.22 Recruit Photo Shoot")) %>%
  arrange(desc(grand_total_amt))
  
  
  

```

# recruiting money 2021

# Preferred Athlete Scouting Services - 2021/2022 Gold Recruiting Subscription (mbb 2022)
# DC, VA (NOVA/Tidewater), and MD (PG County) Premium Scouting Packages (football in 2022)
# ThunderCloud Scout - Annual NCAA Subscription - $25,000 annually (MBB?)

# National HS and Offer Tracker - BCS (fb 22)

# The Underclassman Report - National Package with Portal and Archive 2021-22 (football 22)

# Year 4 - GPS Tracking System, FY22
(?who to attrib to?)
```{r}

presica21 <- ledger_2021 %>%
  clean_names() %>%
  filter(grepl("PRES-ICA-Director's Office/Admin", organization_name))

# filter for FB
recruit_football21 <- presica21 %>%
  filter(itm_desc %in% c('Cole Field House "Throne" for Recruiting Suite', 'Pro Football Focus - Football Scouting Software FY22', 'Tracking Football LLC - annual football recruiting subscription service (Advanced Plus Package)', 'JuCo Football Scouting - REC Platinum package 3.1.21-2.28.22', 'Football Recruiting Lanyards', 'RECRUIT - Football national high school recruiting service/database 10.1.21-9.30.22', 'Football minibus for recruiting', 'DC, VA (NOVA/Tidewater), and MD (PG County) Premium Scouting Packages', 'National HS and Offer Tracker - BCS', 'The Underclassman Report - National Package with Portal and Archive 2021-22', 'Football minibus for recruiting'))


recruit_wbb21 <- presica21 %>%
  filter(itm_desc %in% c("Women's Basketball recruiting scheduling service", "Photo Services for Women's Basketball recruiting", "WBB recruiting service for the 2021-22 season", "WBB to DC for official visits sightseeing 9.11.21", "Ohio Girls Basketball Report - 2021-2022 Recruiting Service", "Collegiate Girls Basketball Report - Recruit Central Subscription"))


recruit_mbb21 <- presica21 %>%
  filter(itm_desc %in% c("Hoop 1 Video - Men's Basketball scouting subscription 20-21 Season", "Men's Basketball recruiting  scheduling service", "Photo Services for Men's Basketball Recruiting 7.5.21", "National Recruiting Report - MBB 2021-22 Season", "MBB Scouting Service 5/31/21 to 5/31/22", "Preferred Athlete Scouting Services - 2021/2022 Gold Recruiting Subscription", "ThunderCloud Scout - Annual NCAA Subscription - $25,000 annually (Item#5308)"))

#totals 

total21_vendors <- ledger_2021 %>%
  clean_names() %>%
   filter(itm_desc %in% c("Women's Basketball recruiting scheduling service", "Photo Services for Women's Basketball recruiting", "WBB recruiting service for the 2021-22 season", "WBB to DC for official visits sightseeing 9.11.21", "Ohio Girls Basketball Report - 2021-2022 Recruiting Service", "Collegiate Girls Basketball Report - Recruit Central Subscription", "Hoop 1 Video - Men's Basketball scouting subscription 20-21 Season", "Men's Basketball recruiting  scheduling service", "Photo Services for Men's Basketball Recruiting 7.5.21", "National Recruiting Report - MBB 2021-22 Season", "MBB Scouting Service 5/31/21 to 5/31/22", "Preferred Athlete Scouting Services - 2021/2022 Gold Recruiting Subscription", "ThunderCloud Scout - Annual NCAA Subscription - $25,000 annually (Item#5308)", 'Cole Field House "Throne" for Recruiting Suite', 'Pro Football Focus - Football Scouting Software FY22', 'Tracking Football LLC - annual football recruiting subscription service (Advanced Plus Package)', 'JuCo Football Scouting - REC Platinum package 3.1.21-2.28.22', 'Football Recruiting Lanyards', 'RECRUIT - Football national high school recruiting service/database 10.1.21-9.30.22', 'Football minibus for recruiting', 'DC, VA (NOVA/Tidewater), and MD (PG County) Premium Scouting Packages', 'National HS and Offer Tracker - BCS', 'The Underclassman Report - National Package with Portal and Archive 2021-22', 'Football minibus for recruiting'))%>%
arrange(desc(amt_paid))
  

```

# reading all vendors to an excel

```{r}

all_recruiting <- list('Sheet1' = total21_vendors, 'Sheet2' = total22_vendors)
write.xlsx(all_recruiting, file = 'C:/Users/Vstav/OneDrive/Documents/GitHub/dbk_datadesk/recruiting')

```


# totals 22
```{r}

recruit_football22 %>%
  mutate(total = sum(grand_total_amt))

  
  recruit_wbb22 %>%
    mutate(total = sum(grand_total_amt))

  
  recruit_bbal22 %>%
    mutate(total = sum(grand_total_amt))


```

# totals 21
```{r}

recruit_football21 %>%
  mutate(total = sum(amt_paid))

  
  recruit_wbb21 %>%
    mutate(total = sum(amt_paid))

  
  recruit_mbb21 %>%
    mutate(total = sum(amt_paid))


```

```{r}

library(openxlsx)

all_recruiting <- list('Sheet1' = recruit_football22, 'Sheet2' = recruit_football21, 'Sheet3' = recruit_bbal22, 'Sheet4' = recruit_mbb21, 'Sheet5' = recruit_wbb22, 'Sheet6' = recruit_wbb21)
write.xlsx(all_recruiting, file = 'C:/Users/Vstav/Downloads/recruiting.xlsx')

```

# mascot research
```{r}

testudo22 <- ledger_2022 %>%
  as.data.frame() %>%
  clean_names() %>%
  filter(grepl("mascot", item_ld))

testudo21 <- ledger_2021 %>%
  as.data.frame() %>%
  clean_names() %>%
  filter(grepl("mascot", itm_desc))

testudo20 <- ledger_2020 %>%
  as.data.frame() %>%
  clean_names() %>%
  filter(grepl("mascot", item_ld))
  

```

OLD
```{r}

correctional_spending_2017 <- ledger_2017 %>%
  clean_names %>%
  filter(vendor_name == "MARYLAND CORRECTIONAL")

correctional_spending_2017 %>%
  summarize(
    sum(grand_total_amt)
  )

correctional_spending_2018 <- ledger_2018 %>%
  clean_names %>%
  filter(vendor_name == "MARYLAND CORRECTIONAL")

correctional_spending_2018 %>%
  summarize(
    sum(grand_total_amt)
  )

correctional_spending_2019 <- ledger_2019 %>%
  clean_names %>%
  filter(vendor_name == "MARYLAND CORRECTIONAL")

correctional_spending_2019 %>%
  summarize(
    sum(grand_total_amt)
  )

correctional_spending_2020 <- ledger_2020 %>%
  clean_names %>%
  filter(vendor_name == "MARYLAND CORRECTIONAL")

correctional_spending_2020 %>%
  summarize(
    sum(grand_total_amt)
  )

correctional_spending_2021 <- ledger_2021 %>%
  clean_names %>%
  filter(vendor_name == "MARYLAND CORRECTIONAL")

correctional_spending_2021 %>%
  summarize(
    sum(amt_paid)
  )

correctional_spending_2022 <- ledger_2022 %>%
  clean_names %>%
  filter(vendor_name == "MARYLAND CORRECTIONAL")

correctional_spending_2022 %>%
  summarize(
    sum(grand_total_amt)
  )


```


